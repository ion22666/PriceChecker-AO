(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var s=e.n(t);const n=require("chalk");var a=e.n(n);const o=require("mongodb"),r=(async()=>({items:(await o.MongoClient.connect(`mongodb+srv://${process.env.MONGODB_USERNAME}:${process.env.MONGODB_PASSWORD}@cluster0.wgurxzm.mongodb.net/?retryWrites=true&w=majority`)).db("AO_Price_Checker").collection("items")}))(),i=process.cwd()+"\\dist\\assets\\",l={index:(e,t)=>{t.status(200).json({message:"Api Page"})},items:async(e,t)=>{let s=(n=await(await r).items.findOne({$or:[{UniqueName:e.params.unique_name},{"LocalizedNames.EN-US":e.params.unique_name}]}))?(n.get_img_url=(e=1)=>`https://render.albiononline.com/v1/item/${n.UniqueName}.png${null!==e?"?qulity="+e:void 0}`,n):null;var n;s?t.status(200).json({status:"OK",data:{...s,img_url:s.get_img_url()}}):t.status(404).json({status:"ERROR",error:"Item Not Found"})}},d=require("fs");var u=e.n(d);const c=[{url:"/",method:"all",handler:(e,t)=>{t.status(200).sendFile(i+"html\\index.html")}},{url:"/favicon.ico",method:"get",handler:(e,t)=>{t.writeHead(200,{"Content-Type":"image/x-icon","Content-Length":u().statSync("./dist/assets/favicon.ico").size,Connection:"keep-alive"}),u().createReadStream("./dist/assets/favicon.ico").pipe(t)}},{url:"/api",method:"all",handler:l.index},{url:"/api/items/:unique_name?",method:"all",handler:l.items}],m=s()();m.use(s().json()),m.use(((e,t,s)=>{let n=performance.now();console.log(a().bold.bgHex("#262626")(a().blueBright("REQUEST  "),a().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),a().cyan(e.url.padEnd(48," ")))),t.on("finish",(()=>{console.log(a().bold.bgHex("#363636")(a().hex("#FFA500")("RESPONSE "),a().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),a().cyan(e.url.padEnd(36," ")),a().hex(t.statusCode>=400?"#ff0000":t.statusCode>=300?"#FFA500":"#00ff00")(t.statusCode),a().hex("#000000")(Math.round(performance.now()-n).toString().padStart(5," ")+"ms")))})),s()})),c.forEach((e=>{m[e.method](e.url,e.handler)})),m.use("/",s().static("dist/assets")),m.use(((e,t,s)=>{t.status(404).sendFile(i+"html\\404.html")}));const h=m.listen(3e3,"127.0.0.1",(()=>{let e=h.address();console.log(a().greenBright.bold.bgHex("#000")("Server is running on "+a().cyanBright("http://"+e.address+":"+e.port)))}))})();