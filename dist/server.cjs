(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("chalk");var r=e.n(t);const a=require("express");var o=e.n(a);const n=process.cwd()+"\\dist\\assets\\",s=process.env.PROD?"production":"development",l={start:[["",function(e,t,r){e.originalUrl.match(/\/favicon\.ico$/)?"GET"===e.method.toUpperCase()?t.status(200).sendFile(n+"img\\favicon.ico"):t.status(406).json({message:"Method Not Allowed"}):r()}],["",o().json()],["",o().urlencoded({extended:!0})]],end:[["/",o().static("dist/assets")],["",(e,t,r)=>{t.status(404).sendFile(n+"html\\404.html")}]]};"development"==s&&l.start.unshift(["",(e,t,a)=>{let o=performance.now();console.log(r().bold.bgHex("#262626")(r().blueBright("REQUEST  "),r().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),r().cyan(e.originalUrl.padEnd(48," ")))),t.on("finish",(()=>{console.log(r().bold.bgHex("#363636")(r().hex("#FFA500")("RESPONSE "),r().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),r().cyan(e.originalUrl.padEnd(36," ")),r().hex(t.statusCode>=400?"#ff0000":t.statusCode>=300?"#FFA500":"#00ff00")(t.statusCode),r().hex("#000000")(Math.round(performance.now()-o).toString().padStart(5," ")+"ms")))})),a()}]);const i=l,c=o().Router();c.route("/").get(((e,t)=>t.status(200).sendFile(n+"html\\index.html"))).all(((e,t)=>{t.status(405).sendFile(n+"html\\405.html")}));const u=c,h=require("mongodb");class g{static _collections;static async connect(){let e=await h.MongoClient.connect(`mongodb+srv://${process.env.MONGODB_USERNAME}:${process.env.MONGODB_PASSWORD}@cluster0.wgurxzm.mongodb.net/?retryWrites=true&w=majority`);g._collections={itemsArray:e.db("ao-items").collection("items-array"),itemsTree:e.db("ao-items").collection("items-tree")}}static get collections(){return g._collections}}const m=g,d=["all","melee","magic","ranged","offhand","armor","accessories","mounts","gatherergear","tools","consumables","skillbooks","resources","cityresources","artefacts","materials","token","farmables","products","luxurygoods","trophies","furniture","labourers","other"],f={all:["all"],melee:["axe","dagger","hammer","mace","quarterstaff","spear","sword","knuckles"],magic:["arcanestaff","cursestaff","firestaff","froststaff","holystaff","naturestaff"],ranged:["bow","crossbow"],offhand:["book","orb","totem","horn","torch","shield"],armor:["cloth_helmet","leather_helmet","plate_helmet","unique_helmet","cloth_armor","leather_armor","plate_armor","unique_armor","cloth_shoes","leather_shoes","plate_shoes","unique_shoes"],accessories:["cape","bag"],mounts:["ridinghorse","armoredhorse","ox","mule","cougar","direwolf","direbear","direboar","swampdragon","giantstag","rare_mount","battle_mount"],gatherergear:["fibergatherer_helmet","fishgatherer_helmet","hidegatherer_helmet","oregatherer_helmet","rockgatherer_helmet","woodgatherer_helmet","fibergatherer_armor","fishgatherer_armor","hidegatherer_armor","oregatherer_armor","rockgatherer_armor","woodgatherer_armor","fibergatherer_shoes","fishgatherer_shoes","hidegatherer_shoes","oregatherer_shoes","rockgatherer_shoes","woodgatherer_shoes","fibergatherer_backpack","fishgatherer_backpack","hidegatherer_backpack","oregatherer_backpack","rockgatherer_backpack","woodgatherer_backpack"],tools:["demolitionhammer","fishing","pickaxe","sickle","skinningknife","stonehammer","woodaxe"],consumables:["cooked","potion","fishingbait","fish","vanity","maps","kill_emotes","other"],skillbooks:["skillbook","skillbook_fiber","skillbook_hide","skillbook_ore","skillbook_rock","skillbook_wood"],resources:["fiber","hide","ore","rock","wood","cloth","leather","metalbar","stoneblock","planks","other"],cityresources:["beastheart","mountainheart","rockheart","treeheart","vineheart","blackheart"],artefacts:["magic_artefact","ranged_artefact","melee_artefact","armor_artefact","offhand_artefact","other"],materials:["essence","rune","relic","soul","other"],token:["arenasigils","event","royalsigils","maps","crystalleague","other"],farmables:["animals","seed"],products:["journal","farming","animals","cooked"],luxurygoods:["bridgewatch","caerleon","fortsterling","lymhurst","martlock","thetford","any"],trophies:["fibertrophy","fishtrophy","generaltrophy","hidetrophy","mercenarytrophy","oretrophy","rocktrophy","woodtrophy"],furniture:["banner","bed","decoration_furniture","flag","heretic_furniture","keeper_furniture","morgana_furniture","repairkit","table","chest","unique"],labourers:["woodcontract","stonecontract","fibercontract","hidecontract","orecontract","mercenarycontract","warriorcontract","magecontract","huntercontract","toolmakercontract","fishingcontract"],other:["mission","other","trash"]},p=["Index","@uniquename","UniqueName","@tier","LocalizedNames"],b=["EN-US","DE-DE","FR-FR","RU-RU","PL-PL","ES-ES","PT-BR","IT-IT","ZH-CN","KO-KR","JA-JP","ZH-TW","ID-ID"];function y(e,t,r,a,o,n){if(!t)return r;if(a&&a.includes(t))return r;if(o&&!o.includes(t))throw new Error(e+" is not acceptable");if(n)try{let r=parseInt(t);if(r<n[0])throw new Error(e+" is too small, needs to be in range: "+n[0]+"-"+n[1]);if(r>n[1])throw new Error(e+" is too large, needs to be in range: "+n[0]+"-"+n[1])}catch(t){throw new Error(e+" needs to be a number")}return t}const _=o().Router();_.route("/*").all(((e,t,r)=>{let a=400;try{if("GET"!=e.method.toUpperCase()&&(a=405))throw new Error("Method Not Allowed");if(e.query.lang=e.query.lang?e.query.lang:"EN-US","EN-US"!=e.query.lang&&!b.includes(e.query.lang)&&(a=400))throw new Error(`Language Not Supported, supported languages: ${b}`)}catch(e){return t.status(a).send({status:"ERROR",reason:e.message})}r()})),_.route("/").get(((e,t)=>{t.status(200).json({message:"Albion Online Items API",content:{"Search Item":"/api/items/<unique_name || localized_name>",Sources:["https://raw.githubusercontent.com/broderickhyman/ao-bin-dumps/master/formatted/items.json","https://raw.githubusercontent.com/broderickhyman/ao-bin-dumps/master/items.json"]}})})),_.route("/item/:name").get((async(e,t)=>{let r=await m.collections.itemsArray.findOne({$or:[{UniqueName:e.params.name},{[`LocalizedNames.${e.params.lang}`]:e.params.name},{"@uniquename":e.params.name}]});r?t.status(200).json({status:"OK",data:r}):t.status(404).json({status:"ERROR",error:"Item Not Found"})})),_.route("/items").get(((e,t,r)=>{let a=e.query;try{a.count=y("Count",a.count?.toString(),"10",null,null,[1,50]),a.page=y("Page",a.page?.toString(),"0",null,null,[0,100]),a.enchant=y("Enchantent",a["@enchantmentlevel"]?.toString(),"*",["all","any"],null,[0,4]),a.tier=y("Tier",a.tier?.toString(),"*",["all","any"],null,[0,8]),a.quality=y("Quality",a.quality?.toString(),"1",["all","any"],null,[1,5]),a.sort=y("Sort",a.sort?.toString(),"Index",["all","any"],p,null),a.search=y("Search",a.search?.toString(),"",null,null,null);let e=a.category=y("Category",a.category?.toString(),"*",["all","any"],d,null),t=a.sub_category=y("Sub-Category",a.sub_category?.toString(),"*",["all","any"],f[e],null),r=a.database=y("Database",a.database?.toString(),"1",null,null,[1,2]);if("*"!=t&&"*"==e)throw new Error("Sub-Category cannot exist without Category");if("2"==r&&("*"==e||"*"==t))throw new Error("The all/any method is only available with database=1")}catch(e){return t.status(400).json({status:"ERROR",reason:e.message})}r()}),(async(e,t)=>{let r=e.query;console.log(r);let a=[];if("1"==r.database){let e={},t=(t,r,a,o)=>{r!=a?e[t]=r:o&&(e[t]=o)};t("@showinmarketplace","*","*",{$in:["true",void 0]}),t("@shopcategory",r.category?.toString(),"*",null),t("@shopsubcategory1",r.sub_category?.toString(),"*",null),t("@enchantmentlevel",r.enchant?.toString(),"*",null),t("@tier",r.tier?.toString(),"*",null);let o=new RegExp(r.search.toString(),"ig");"0"==r.tier?.toString()&&t("@tier","*","*",{$in:["0",void 0]}),"1"!=r.quality?.toString()&&t("@maxqualitylevel","*","*",{$exists:1}),a=await m.collections.itemsArray.aggregate([{$match:e},{$match:{$or:[{UniqueName:o},{"@uniquename":o},{[`LocalizedNames.${r.lang.toString()}`]:o}]}}]).sort({[r.sort.toString()]:1}).skip(parseInt(r.page.toString())*parseInt(r.count.toString())).limit(parseInt(r.count.toString())).toArray()}return 0===a.length?t.status(404).json({status:"ERROR",reason:"No Items Found"}):t.status(200).json({status:"OK",data:a})}));const k=_,w=o()();i.start.forEach(((e,t)=>{"development"==s&&0==t||w.use(...e)})),w.use("/",u),w.use("/api",k),i.end.forEach((e=>w.use(...e)));const S=w;(async()=>{if(await m.connect(),"production"==s)S.listen(8e3,"0.0.0.0",(()=>{console.log("Server is running ...")}));else{const e=S.listen(3e3,"127.0.0.1",(()=>{let t=e.address();console.log(r().greenBright.bold.bgHex("#000")("Server is running on "+r().cyanBright("http://"+t.address+":"+t.port)))}))}})()})();