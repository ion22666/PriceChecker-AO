(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("chalk");var s=e.n(t);const o=require("express");var a=e.n(o);const n=process.cwd()+"\\dist\\assets\\",r={start:[["",(e,t,o)=>{let a=performance.now();console.log(s().bold.bgHex("#262626")(s().blueBright("REQUEST  "),s().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),s().cyan(e.originalUrl.padEnd(48," ")))),t.on("finish",(()=>{console.log(s().bold.bgHex("#363636")(s().hex("#FFA500")("RESPONSE "),s().hex("#00ff00")(e.method.toUpperCase().padEnd(5," ")),s().cyan(e.originalUrl.padEnd(36," ")),s().hex(t.statusCode>=400?"#ff0000":t.statusCode>=300?"#FFA500":"#00ff00")(t.statusCode),s().hex("#000000")(Math.round(performance.now()-a).toString().padStart(5," ")+"ms")))})),o()}],["",function(e,t,s){e.originalUrl.match(/\/favicon\.ico$/)?"GET"===e.method.toUpperCase()?t.status(200).sendFile(n+"img\\favicon.ico"):t.status(406).json({message:"Method Not Allowed"}):s()}],["",a().json()],["",a().urlencoded({extended:!0})]],end:[["/",a().static("dist/assets")],["",(e,t,s)=>{t.status(404).sendFile(n+"html\\404.html")}]]},i=(e,t)=>{t.status(405).sendFile(n+"html\\405.html")},l=i,c=a().Router();c.route("/").get(((e,t)=>{t.status(200).sendFile(n+"html\\index.html")})).all(l);const u=c,m=require("mongodb");class d{static _collections;static async connect(){let e=await m.MongoClient.connect(`mongodb+srv://${process.env.MONGODB_USERNAME}:${process.env.MONGODB_PASSWORD}@cluster0.wgurxzm.mongodb.net/?retryWrites=true&w=majority`);d._collections={items:e.db("ao-items").collection("items"),items1:e.db("ao-items").collection("items1")}}static get collections(){return d._collections}}const g=d;function p(e){return e?(e.get_img_url=(t=1)=>`https://render.albiononline.com/v1/item/${e.UniqueName}.png${null!==t?"?qulity="+t:void 0}`,e):null}const h=["EN-US","DE-DE","FR-FR","RU-RU","PL-PL","ES-ES","PT-BR","IT-IT","ZH-CN","KO-KR","JA-JP","ZH-TW","ID-ID"],E=a().Router();E.route("/*").all(((e,t,s)=>{if("GET"!=e.method.toUpperCase())return i(0,t);s()})).get(((e,t,s)=>{let o=e.query.lang?.toUpperCase();if(t.locals.lang=o?h.includes(o)?o:"INVALID":"EN-US","INVALID"===o)return t.status(400).json({status:"ERROR",error:'Language Not Supported, supported languages: "EN-US", "DE-DE", "FR-FR", "RU-RU", "PL-PL", "ES-ES", "PT-BR", "IT-IT", "ZH-CN", "KO-KR", "JA-JP", "ZH-TW", "ID-ID"'});s()})),E.route("/").get(((e,t)=>{t.status(200).json({message:"Api Page"})})),E.route("/items").get(((e,t)=>{t.status(200).json({message:"Albion Online Items API",content:{"Search Item":"/api/items/<unique_name || localized_name>",Sources:["https://raw.githubusercontent.com/broderickhyman/ao-bin-dumps/master/formatted/items.json","https://raw.githubusercontent.com/broderickhyman/ao-bin-dumps/master/items.json"]}})})),E.route("/items/:count([0-9]+)-:page([0-9]+)/:category?/:sub_category?").get((async(e,t)=>{try{let s=parseInt(e.params.count),o=parseInt(e.params.page);if(e.params.categoty,e.params.sub_categoty,s&&(s>100||s<0))throw new Error("Items counts is not valid");if(o&&o<0)throw new Error("Page number is not valid");let a=await g.collections.items1.find({"@shopcategory":"melee","@shopsubcategory1":"axe"}).limit(10).toArray();if(0===a.length)throw new Error("No Items Found");return a.map((e=>{e.img_url=p(e)?.get_img_url()})),t.status(200).json({status:"OK",data:a})}catch(e){return t.status(400).json({status:"ERROR",error:e.message})}})),E.route("/items/:name").get((async(e,t)=>{let s=p(await g.collections.items.findOne({$or:[{UniqueName:e.params.name},{[`LocalizedNames.${e.params.lang}`]:e.params.name}]},{projection:(o=t.locals.lang,{_id:0,[`LocalizedNames.${o}`]:1,[`LocalizedDescriptions.${o}`]:1,UniqueName:1})}));var o;s?t.status(200).json({status:"OK",data:{...s,img_url:s.get_img_url()}}):t.status(404).json({status:"ERROR",error:"Item Not Found"})}));const f=E,b=a()();r.start.forEach((e=>b.use(...e))),b.use("/",u),b.use("/api",f),r.end.forEach((e=>b.use(...e)));const R=b,y="development";(async()=>{await g.connect();const e=R.listen(3e3,"development"==y?"127.0.0.1":"0.0.0.0",(()=>{let t=e.address();console.log(s().greenBright.bold.bgHex("#000")("Server is running on "+s().cyanBright("http://"+t.address+":"+t.port)))}))})()})();